---
title: "Team ACDC Case Study 6: Spam Ham, Problem 19"
author: "David Josephs, Andy Heroy, Carson Drake, Che' Cobb"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    number_sections: true
    theme: readable
    highlight: haddock
    code_folding: hide
    df_print: paged
    keep_md: TRUE
    fig_width: 10
    fig_height: 10
    fig_retina: true
    fig_caption: true
---


```{r setup, include = F}
knitr::opts_chunk$set(warning = F, message = F, dev = "svg", fig.align = "center")
knitr::opts_chunk$set(tidy = T)
knitr::opts_chunk$set(comment = '#>')
options(digits = 2)

```

# Introduction


## Data Description


```{r dataload}
# we are starting from here, 
# the code used to create the RDA will be shown in the appendix, 
# it seems to run fine on windows but crash on linux
# so this was a good compromise without digging too deeply into the web of 
# lapplys
load("./Data/data.Rda")
emails <- emailDFrp
# probably do the n
# This function...  is strange.
setupRnum = function(data) {
  logicalVars = which(sapply(data, is.logical))
  facVars = lapply(data[ , logicalVars], 
                   function(x) {
                      x = as.numeric(x)
                   })
  cbind(facVars, data[ , - logicalVars])
}

emails = setupRnum(emails)
dim(emails)
emails[is.na(emails)]<-0
df_process <- emails

```

# Analysis

## Minimum Split

```{r}
library(rpart)
library(caret)
library(dplyr)
library(rpart.plot)
set.seed(54)

#Get a count for spam and ham
is_Spam_ct <- table(df_process$isSpam)["T"]
is_Ham_ct <- table(df_process$isSpam)["F"]

#Sample the indexes
testSpamidx = sample(is_Spam_ct, size = floor(is_Spam_ct/3))
testHamidx = sample(is_Ham_ct, size = floor(is_Ham_ct/3))

#Create DF for test and train
df_test_rpart = rbind(df_process[df_process$isSpam == "T",][testSpamidx,],
                      df_process[df_process$isSpam == "F",][testHamidx, ])

df_train_rpart = rbind(df_process[df_process$isSpam == "T",][-testSpamidx,],
                      df_process[df_process$isSpam == "F",][-testHamidx, ])

dim(df_train_rpart)

#Fitting the regression tree.
rpart_fit = rpart(isSpam ~ ., 
                  data = df_train_rpart,
                  minsplit = 2,
                  method = "class")

#Plot it with either prp or rpart.plot
#prp(rpart_fit, extra = 106)
rpart.plot(rpart_fit)

#Now lets make some predictions.  We'll predict on the df_test_rpart, with the fit we just achieved directly above. 

rp_predict <- predict(rpart_fit,
                      newdata = df_test_rpart[, names(df_test_rpart) != "isSpam"],
                      type = "class")

#summary(rp_predict)

spam_predict = rp_predict[ df_test_rpart$isSpam == "T"]
ham_predict = rp_predict[ df_test_rpart$isSpam == "F"]




```
Minsplit vs ntrees and accuracy/related metrics

## Ratio of minsplit and minbuxkets
normally its 3:1, see what happens

## Complexity and interaction with minsplit

### Lots o trees

### Few o trees

## Maxdepth

### Deep and wide

### Deep and narrow

### Short and wide

### Short and narrow

## Surragets
maybe
##xval
maybe

# Conclusion

Use cases for interesitng chouces
